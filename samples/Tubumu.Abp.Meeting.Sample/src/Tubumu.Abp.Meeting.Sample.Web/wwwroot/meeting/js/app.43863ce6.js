(function(e){function r(r){for(var a,c,s=r[0],i=r[1],u=r[2],p=0,m=[];p<s.length;p++)c=s[p],Object.prototype.hasOwnProperty.call(n,c)&&n[c]&&m.push(n[c][0]),n[c]=0;for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a]);d&&d(r);while(m.length)m.shift()();return o.push.apply(o,u||[]),t()}function t(){for(var e,r=0;r<o.length;r++){for(var t=o[r],a=!0,s=1;s<t.length;s++){var i=t[s];0!==n[i]&&(a=!1)}a&&(o.splice(r--,1),e=c(c.s=t[0]))}return e}var a={},n={app:0},o=[];function c(r){if(a[r])return a[r].exports;var t=a[r]={i:r,l:!1,exports:{}};return e[r].call(t.exports,t,t.exports,c),t.l=!0,t.exports}c.m=e,c.c=a,c.d=function(e,r,t){c.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,r){if(1&r&&(e=c(e)),8&r)return e;if(4&r&&"object"===typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(c.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var a in e)c.d(t,a,function(r){return e[r]}.bind(null,a));return t},c.n=function(e){var r=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(r,"a",r),r},c.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},c.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],i=s.push.bind(s);s.push=r,s=s.slice();for(var u=0;u<s.length;u++)r(s[u]);var d=i;o.push([0,"chunk-vendors"]),t()})({0:function(e,r,t){e.exports=t("56d7")},"034f":function(e,r,t){"use strict";var a=t("85ec"),n=t.n(a);n.a},"56d7":function(e,r,t){"use strict";t.r(r);t("e260"),t("e6cf"),t("cca6"),t("a79d");var a=t("2b0e"),n=t("5c96"),o=t.n(n),c=(t("0fae"),function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{attrs:{id:"app"}},[t("el-container",[t("el-header",[e._v("Demo")]),t("el-container",[t("el-aside",{attrs:{width:"400px"}},[t("div",{staticClass:"demo-block"},[t("el-form",{ref:"joinForm",attrs:{inline:!0,"label-width":"100px",size:"mini"}},[t("el-form-item",{attrs:{label:"Connect:"}}),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.onJoin}},[e._v(e._s(e.joinForm.isJoined?"Leave":"Join"))])],1)],1)],1),e.joinForm.isJoined?t("div",{staticClass:"demo-block"},[t("el-form",{ref:"roomForm",attrs:{inline:!0,model:e.roomForm,"label-width":"100px",size:"mini"}},[t("el-form-item",{attrs:{label:"Room:"}},[t("el-select",{attrs:{disabled:e.roomForm.isJoinedRoom,clearable:"",placeholder:"请选择"},model:{value:e.roomForm.roomId,callback:function(r){e.$set(e.roomForm,"roomId",r)},expression:"roomForm.roomId"}},e._l(e.rooms,(function(e,r){return t("el-option",{key:e,attrs:{label:"Room "+r,value:r}})})),1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.onJoinRoom}},[e._v(e._s(e.roomForm.isJoinedRoom?"Leave":"Join"))])],1)],1)],1):e._e(),e.joinForm.isJoined&&e.roomForm.isJoinedRoom?t("div",{staticClass:"demo-block"},[t("el-form",{ref:"peersForm",attrs:{model:e.peersForm,"label-width":"0px",size:"mini"}},[t("el-form-item",[t("el-table",{ref:"singleTable",staticStyle:{width:"100%"},attrs:{data:e.peersForm.peers,"highlight-current-row":""},on:{"current-change":e.onPeerNodeClick}},[t("el-table-column",{attrs:{type:"index",width:"50"}}),t("el-table-column",{attrs:{property:"displayName",label:"DisplayName"}})],1)],1)],1)],1):e._e()]),t("el-main",[e.webcamProducer?t("video",{ref:"localVideo",attrs:{id:"localVideo",autoplay:"",playsinline:""},domProps:{srcObject:e.localVideoStream}}):e._e(),e._l(e.remoteVideoStreams,(function(e,r){return t("video",{key:r,attrs:{autoplay:"",playsinline:""},domProps:{srcObject:e}})})),e._l(e.remoteAudioStreams,(function(e,r){return t("audio",{key:r,attrs:{autoplay:""},domProps:{srcObject:e}})}))],2)],1)],1)],1)}),s=[],i=(t("7db0"),t("a630"),t("a434"),t("c19f"),t("4ec9"),t("d3b7"),t("07ac"),t("ac1f"),t("25f0"),t("3ca3"),t("5319"),t("841c"),t("ddb0"),t("b85c")),u=t("5530"),d=(t("96cf"),t("1da1")),p=t("d4ec"),m=t("bee2"),l=t("34eb"),b=t.n(l),f="tubumu-abp-meeting-sample-client",v=function(){function e(r){Object(p["a"])(this,e),r?(this._debug=b()("".concat(f,":").concat(r)),this._warn=b()("".concat(f,":WARN:").concat(r)),this._error=b()("".concat(f,":ERROR:").concat(r))):(this._debug=b()(f),this._warn=b()("".concat(f,":WARN")),this._error=b()("".concat(f,":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}return Object(m["a"])(e,[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}]),e}(),g=t("b383"),h=t.n(g),w=t("ddfa"),k=t("e87a"),x={qvga:{width:{ideal:320},height:{ideal:240}},vga:{width:{ideal:640},height:{ideal:480}},hd:{width:{ideal:1280},height:{ideal:720}}},P={optional:[{googDscp:!0}]},R=[{scaleResolutionDownBy:4,maxBitrate:5e5},{scaleResolutionDownBy:2,maxBitrate:1e6},{scaleResolutionDownBy:1,maxBitrate:5e6}],D=[{scalabilityMode:"S3T3_KEY"}],C=new v("App");localStorage.setItem("debug","mediasoup-client:* tubumu-abp-meeting-sample-client:*");var I={name:"app",components:{},data:function(){return{connection:null,mediasoupDevice:null,sendTransport:null,recvTransport:null,nextDataChannelTestNumber:0,webcams:{},audioDevices:{},webcamProducer:null,micProducer:null,useSimulcast:!1,forceH264:!1,forceVP9:!1,localVideoStream:null,remoteVideoStreams:{},remoteAudioStreams:{},producers:new Map,consumers:new Map,dataProducer:null,dataConsumers:new Map,joinForm:{isJoined:!1},roomForm:{roomId:[],isJoinedRoom:!1},peersForm:{peers:[]},defaultProps:{children:"children",label:"label"},form:{consume:!0,produce:!0,useDataChannel:!1},rooms:["Room 0","Room 1","Room 2","Room 3","Room 4","Room 5","Room 6","Room 7","Room 8","Room 9"]}},mounted:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var t,a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t=h.a.parse(location.search.replace("?","")),a=t.roomId,n=t.roomid,e.roomForm.roomId=a||n,e.roomForm.roomId&&(e.roomForm.roomId=parseInt(e.roomForm.roomId));case 3:case"end":return r.stop()}}),r)})))()},methods:{onJoin:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var t;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!e.joinForm.isJoined){r.next=12;break}if(!e.connection){r.next=4;break}return r.next=4,e.connection.stop();case 4:return e.joinForm.isJoined=!1,e.roomForm.isJoinedRoom=!1,e.webcamClosed(),e.micClosed(),e.peersForm.peers=[],e.remoteVideoStreams={},e.remoteAudioStreams={},r.abrupt("return");case 12:return r.prev=12,t="",e.connection=(new k["a"]).withUrl("".concat(t,"/signalr-hubs/meeting"),{}).build(),e.connection.onclose((function(r){e.joinForm.isJoined=!1,r&&C.error(r)})),e.connection.on("Notify",function(){var r=Object(d["a"])(regeneratorRuntime.mark((function r(t){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,e.processNotification(t);case 2:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()),r.next=19,e.connection.start();case 19:return r.next=21,e.start();case 21:e.joinForm.isJoined=!0,r.next=27;break;case 24:r.prev=24,r.t0=r["catch"](12),C.debug(r.t0.message);case 27:case"end":return r.stop()}}),r,null,[[12,24]])})))()},start:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var t,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,e.connection.invoke("GetRouterRtpCapabilities");case 2:if(t=r.sent,200===t.code){r.next=6;break}return C.error("processNotification() | GetRouterRtpCapabilities failure."),r.abrupt("return");case 6:return a=t.data,e.mediasoupDevice=new w["Device"],r.next=10,e.mediasoupDevice.load({routerRtpCapabilities:a});case 10:return r.next=12,e.connection.invoke("Join",{rtpCapabilities:e.mediasoupDevice.rtpCapabilities,sctpCapabilities:e.form.useDataChannel&&e.form.consume?e.mediasoupDevice.sctpCapabilities:void 0,displayName:null,sources:["mic","webcam"],appData:{}});case 12:if(t=r.sent,200===t.code){r.next=16;break}return C.error("processNotification() | Join failure."),r.abrupt("return");case 16:case"end":return r.stop()}}),r)})))()},onJoinRoom:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var t,a,n,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!e.roomForm.isJoinedRoom){r.next=10;break}return r.next=3,e.connection.invoke("LeaveRoom");case 3:if(t=r.sent,200===t.code){r.next=7;break}return C.error("onJoinRoom() | JoinRoom failure."),r.abrupt("return");case 7:return e.peersForm.peers=[],e.roomForm.isJoinedRoom=!1,r.abrupt("return");case 10:if(e.roomForm.roomId||0===e.roomForm.roomId){r.next=13;break}return e.$message.error("Join room,please."),r.abrupt("return");case 13:return r.next=15,e.connection.invoke("JoinRoom",{roomId:e.roomForm.roomId.toString()});case 15:if(a=r.sent,200===a.code){r.next=19;break}return C.error("onJoinRoom() | JoinRoom failure."),r.abrupt("return");case 19:for(n=a.data.peers,o=0;o<n.length;o++)e.peersForm.peers.push(n[o]);if(e.roomForm.isJoinedRoom=!0,!e.form.produce){r.next=34;break}return r.next=25,e.connection.invoke("CreateSendWebRtcTransport",{forceTcp:!1,sctpCapabilities:e.form.useDataChannel?e.mediasoupDevice.sctpCapabilities:void 0});case 25:if(a=r.sent,200===a.code){r.next=29;break}return C.error("onJoinRoom() | CreateSendWebRtcTransport failed: %s",a.message),r.abrupt("return");case 29:e.sendTransport=e.mediasoupDevice.createSendTransport({id:a.data.transportId,iceParameters:a.data.iceParameters,iceCandidates:a.data.iceCandidates,dtlsParameters:a.data.dtlsParameters,sctpParameters:a.data.sctpParameters,iceServers:[],proprietaryConstraints:P}),e.sendTransport.on("connect",(function(r,t,a){var n=r.dtlsParameters;C.debug("sendTransport.on() connect dtls: %o",n),e.connection.invoke("ConnectWebRtcTransport",{transportId:e.sendTransport.id,dtlsParameters:n}).then(t).catch(a)})),e.sendTransport.on("produce",function(){var r=Object(d["a"])(regeneratorRuntime.mark((function r(t,a,n){var o,c,s,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return o=t.kind,c=t.rtpParameters,s=t.appData,C.debug("sendTransport.on() produce, appData: %o",s),r.prev=2,r.next=5,e.connection.invoke("Produce",{transportId:e.sendTransport.id,kind:o,rtpParameters:c,source:s.source,appData:s});case 5:if(i=r.sent,200===i.code){r.next=10;break}return C.debug(i.message),n(new Error(i.message)),r.abrupt("return");case 10:e.producers.set(i.data.id,i.data),a({id:i.data.id}),r.next=17;break;case 14:r.prev=14,r.t0=r["catch"](2),n(r.t0);case 17:case"end":return r.stop()}}),r,null,[[2,14]])})));return function(e,t,a){return r.apply(this,arguments)}}()),e.sendTransport.on("producedata",function(){var r=Object(d["a"])(regeneratorRuntime.mark((function r(t,a,n){var o,c,s,i,u,d;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return o=t.sctpStreamParameters,c=t.label,s=t.protocol,i=t.appData,C.debug('"producedata" event: [sctpStreamParameters:%o, appData:%o]',o,i),r.prev=2,r.next=5,e._protoo.request("ProduceData",{transportId:e.sendTransport.id,sctpStreamParameters:o,label:c,protocol:s,appData:i});case 5:u=r.sent,d=u.id,a({id:d}),r.next=13;break;case 10:r.prev=10,r.t0=r["catch"](2),n(r.t0);case 13:case"end":return r.stop()}}),r,null,[[2,10]])})));return function(e,t,a){return r.apply(this,arguments)}}()),e.sendTransport.on("connectionstatechange",(function(r){C.debug("sendTransport.on() connectionstatechange: ".concat(r)),"connected"===r&&e.enableDataProducer()}));case 34:return r.next=36,e.connection.invoke("CreateRecvWebRtcTransport",{forceTcp:!1,sctpCapabilities:e.form.useDataChannel?e._mediasoupDevice.sctpCapabilities:void 0});case 36:a=r.sent,e.recvTransport=e.mediasoupDevice.createRecvTransport({id:a.data.transportId,iceParameters:a.data.iceParameters,iceCandidates:a.data.iceCandidates,dtlsParameters:a.data.dtlsParameters,sctpParameters:a.data.sctpParameters,iceServers:[]}),e.recvTransport.on("connect",(function(r,t,a){var n=r.dtlsParameters;C.debug("recvTransport.on() connect dtls: %o",n),e.connection.invoke("ConnectWebRtcTransport",{transportId:e.recvTransport.id,dtlsParameters:n}).then(t).catch(a)})),e.recvTransport.on("connectionstatechange",(function(e){C.debug("recvTransport.on() connectionstatechange: ".concat(e))}));case 40:case"end":return r.stop()}}),r)})))()},onPeerNodeClick:function(e){var r=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return C.debug("onPeerNodeClick() | %o",e),t.next=3,r.pull(e.peerId,e.sources);case 3:case"end":return t.stop()}}),t)})))()},processNewConsumer:function(e){var r=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){var a,n,o,c,s,i,d,p,m,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.producerPeerId,n=e.producerId,o=e.consumerId,c=e.kind,s=e.rtpParameters,i=e.producerAppData,t.next=3,r.recvTransport.consume({id:o,producerId:n,kind:c,rtpParameters:s,appData:Object(u["a"])(Object(u["a"])({},i),{},{producerPeerId:a})});case 3:return d=t.sent,C.debug("processNewConsumer() Consumer: %o",d),r.consumers.set(d.id,d),d.on("transportclose",(function(){r.consumers.delete(d.id)})),p=w["parseScalabilityMode"](d.rtpParameters.encodings[0].scalabilityMode),p.spatialLayers,p.temporalLayers,m=new MediaStream,m.addTrack(d.track),r.$set("video"===c?r.remoteVideoStreams:r.remoteAudioStreams,o,m),C.debug("processNewConsumer() ResumeConsumer"),t.next=14,r.connection.invoke("ResumeConsumer",o);case 14:if(l=t.sent,200===l.code){t.next=18;break}return C.error("processNewConsumer() | ResumeConsumer failure."),t.abrupt("return");case 18:case"end":return t.stop()}}),t)})))()},processNewDataConsumer:function(e){var r=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){var a,n,o,c,s,i,d,p;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.dataProducerPeerId,n=e.dataProducerId,o=e.dataCosumerId,c=e.sctpStreamParameters,s=e.label,i=e.protocol,d=e.dataProducerAppData,t.prev=1,t.next=4,r.recvTransport.consumeData({dataCosumerId:o,dataProducerId:n,sctpStreamParameters:c,label:s,protocol:i,appData:Object(u["a"])(Object(u["a"])({},d),{},{dataProducerPeerId:a})});case 4:p=t.sent,r.dataConsumers.set(p.id,p),p.on("transportclose",(function(){r.dataConsumers.delete(p.id)})),p.on("open",(function(){C.debug('DataConsumer "open" event')})),p.on("close",(function(){C.warn('DataConsumer "close" event'),r.dataConsumers.delete(p.id)})),p.on("error",(function(e){C.error('DataConsumer "error" event:%o',e)})),p.on("message",(function(e){if(C.debug('DataConsumer "message" event [streamId:%d]',p.sctpStreamParameters.streamId),e instanceof ArrayBuffer){var t=new DataView(e),a=t.getUint32();return a==Math.pow(2,32)-1?(C.warn("dataChannelTest finished!"),void(r.nextDataChannelTestNumber=0)):(a>r.nextDataChannelTestNumber&&C.warn("dataChannelTest: %s packets missing",a-r.nextDataChannelTestNumber),void(r.nextDataChannelTestNumber=a+1))}"string"===typeof e?C.debug("New message: ".concat(e)):C.warn('ignoring DataConsumer "message" (not a string)')})),t.next=17;break;case 13:throw t.prev=13,t.t0=t["catch"](1),C.error('"newDataConsumer" request failed:%o',t.t0),t.t0;case 17:case"end":return t.stop()}}),t,null,[[1,13]])})))()},pull:function(e,r){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.connection.invoke("Pull",{producerPeerId:e,sources:r});case 2:if(n=a.sent,200===n.code){a.next=6;break}return C.error("pull() | pull failure."),a.abrupt("return");case 6:case"end":return a.stop()}}),a)})))()},processNotification:function(e){var r=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){var a,n,o,c,s,i,u,d,p,m,l,b,f,v,g,h,w,k,x,P,R;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:C.debug("processNotification() | %o",e),t.t0=e.type,t.next="newConsumer"===t.t0?4:"newDataConsumer"===t.t0?7:"producerScore"===t.t0?10:"peerJoinRoom"===t.t0?12:"peerLeaveRoom"===t.t0?15:"peerRoomAppDataChanged"===t.t0?25:"produceSources"===t.t0?26:"downlinkBwe"===t.t0?43:"consumerClosed"===t.t0?45:"consumerPaused"===t.t0?53:"consumerResumed"===t.t0?58:"consumerLayersChanged"===t.t0?63:"consumerScore"===t.t0?68:"producerClosed"===t.t0?73:"peerLeave"===t.t0?79:89;break;case 4:return t.next=6,r.processNewConsumer(e.data);case 6:return t.abrupt("break",90);case 7:return t.next=9,r.processNewDataConsumer(e.data);case 9:return t.abrupt("break",90);case 10:return a=e.data,a.producerId,a.score,t.abrupt("break",90);case 12:return n=e.data.peer,r.peersForm.peers.push(n),t.abrupt("break",90);case 15:o=e.data.peerId,c=r.peersForm.peers.length-1;case 17:if(!(c>0)){t.next=24;break}if(r.peersForm.peers[c].peerId!==o){t.next=21;break}return r.peersForm.peers.splice(c,1),t.abrupt("break",24);case 21:c--,t.next=17;break;case 24:return t.abrupt("break",90);case 25:return t.abrupt("break",90);case 26:if(r.form.produce){t.next=28;break}return t.abrupt("break",90);case 28:s=e.data.produceSources,i=0;case 30:if(!(i<s.length)){t.next=42;break}if("mic"!==s[i]||!r.mediasoupDevice.canProduce("audio")){t.next=36;break}return t.next=34,r.enableMic();case 34:t.next=39;break;case 36:if("webcam"!==s[i]||!r.mediasoupDevice.canProduce("video")){t.next=39;break}return t.next=39,r.enableWebcam();case 39:i++,t.next=30;break;case 42:return t.abrupt("break",90);case 43:return C.debug("'downlinkBwe' event: %o",e.data),t.abrupt("break",90);case 45:if(u=e.data.consumerId,d=r.consumers.get(u),d){t.next=49;break}return t.abrupt("break",90);case 49:return r.$delete("video"===d.kind?r.remoteVideoStreams:r.remoteAudioStreams,u),d.close(),r.consumers.delete(u),t.abrupt("break",90);case 53:if(p=e.data.consumerId,m=r.consumers.get(p),m){t.next=57;break}return t.abrupt("break",90);case 57:return t.abrupt("break",90);case 58:if(l=e.data.consumerId,b=r.consumers.get(l),b){t.next=62;break}return t.abrupt("break",90);case 62:return t.abrupt("break",90);case 63:if(f=e.data,v=f.consumerId,f.spatialLayer,f.temporalLayer,g=r.consumers.get(v),g){t.next=67;break}return t.abrupt("break",90);case 67:return t.abrupt("break",90);case 68:if(h=e.data.consumerId,w=r.consumers.get(h),w){t.next=72;break}return t.abrupt("break",90);case 72:return t.abrupt("break",90);case 73:if(k=e.data.producerId,x=r.producers.get(k),x){t.next=77;break}return t.abrupt("break",90);case 77:return"webcam"===x.source?r.webcamClosed():"mic"===x.source&&r.micClosed(),t.abrupt("break",90);case 79:P=e.data.peerId,R=r.peersForm.peers.length-1;case 81:if(!(R>0)){t.next=88;break}if(r.peersForm.peers[R].peerId!==P){t.next=85;break}return r.peersForm.peers.splice(R,1),t.abrupt("break",88);case 85:R--,t.next=81;break;case 88:return t.abrupt("break",90);case 89:C.error("unknown data.type, data:%o",e);case 90:case"end":return t.stop()}}),t)})))()},enableDataProducer:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(C.debug("enableChatDataProducer()"),e.form.useDataChannel){r.next=3;break}return r.abrupt("return");case 3:return r.prev=3,r.next=6,e.sendTransport.produceData({ordered:!1,maxRetransmits:1,label:"chat",priority:"medium",appData:{info:""}});case 6:e.dataProducer=r.sent,e.dataProducer.on("transportclose",(function(){e.dataProducer=null})),e.dataProducer.on("open",(function(){C.debug('DataProducer "open" event')})),e.dataProducer.on("close",(function(){C.error('DataProducer "close" event'),e.dataProducer=null})),e.dataProducer.on("error",(function(e){C.error('chat DataProducer "error" event:%o',e)})),e.dataProducer.on("bufferedamountlow",(function(){C.debug('chat DataProducer "bufferedamountlow" event')})),r.next=18;break;case 14:throw r.prev=14,r.t0=r["catch"](3),C.error("enableDataProducer() | failed:%o",r.t0),r.t0;case 18:case"end":return r.stop()}}),r,null,[[3,14]])})))()},enableMic:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var t,a,n,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(C.debug("enableMic()"),!e.micProducer){r.next=3;break}return r.abrupt("return");case 3:if(!e.mediasoupDevice||e.mediasoupDevice.canProduce("audio")){r.next=6;break}return C.error("enableMic() | cannot produce audio"),r.abrupt("return");case 6:return r.prev=6,r.next=9,e._getAudioDeviceId();case 9:if(a=r.sent,n=e.audioDevices[a],n){r.next=13;break}throw new Error("no audio devices");case 13:return C.debug("enableMic() | new selected audio device [device:%o]",n),C.debug("enableMic() | calling getUserMedia()"),r.next=17,navigator.mediaDevices.getUserMedia({audio:{deviceId:{ideal:a}}});case 17:return o=r.sent,t=o.getAudioTracks()[0],r.next=21,e.sendTransport.produce({track:t,codecOptions:{opusStereo:1,opusDtx:1},appData:{source:"mic",roomId:"1"}});case 21:e.micProducer=r.sent,e.micProducer.on("transportclose",(function(){e.micProducer=null})),e.micProducer.on("trackended",(function(){e.disableMic().catch((function(){}))})),e.micProducer.volume=0,r.next=32;break;case 27:r.prev=27,r.t0=r["catch"](6),console.log("enableMic() failed: %o",r.t0),C.error("enableMic() failed: %o",r.t0),t&&t.stop();case 32:case"end":return r.stop()}}),r,null,[[6,27]])})))()},disableMic:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(C.debug("disableMic()"),e.micProducer){r.next=3;break}return r.abrupt("return");case 3:return e.micProducer.close(),r.prev=4,r.next=7,e.connection.invoke("CloseProducer",e.micProducer.id);case 7:r.next=12;break;case 9:r.prev=9,r.t0=r["catch"](4),C.error('disableMic() [error:"%o"]',r.t0);case 12:e.micProducer=null;case 13:case"end":return r.stop()}}),r,null,[[4,9]])})))()},micClosed:function(){this.micProducer&&(this.micProducer.close(),this.micProducer=null)},enableWebcam:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var t,a,n,o,c,s,i,d;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(C.debug("enableWebcam()"),!e.webcamProducer){r.next=3;break}return r.abrupt("return");case 3:if(!e.mediasoupDevice||e.mediasoupDevice.canProduce("video")){r.next=6;break}return C.error("enableWebcam() | cannot produce video"),r.abrupt("return");case 6:return r.prev=6,r.next=9,e._getWebcamDeviceId();case 9:if(a=r.sent,C.debug("_setWebcamProducer() | webcam: ".concat(a)),n=e.webcams.get(a),n){r.next=14;break}throw new Error("no webcam devices: ".concat(JSON.stringify(e.webcams)));case 14:return C.debug("_setWebcamProducer() | new selected webcam [device:%o]",n),C.debug("_setWebcamProducer() | calling getUserMedia()"),r.next=18,navigator.mediaDevices.getUserMedia({video:Object(u["a"])({deviceId:{ideal:a}},x.qvga)});case 18:if(o=r.sent,e.localVideoStream=o,t=o.getVideoTracks()[0],i={videoGoogleStartBitrate:1e3},!e.forceH264){r.next=28;break}if(s=e.mediasoupDevice.rtpCapabilities.codecs.find((function(e){return"video/h264"===e.mimeType.toLowerCase()})),s){r.next=26;break}throw new Error("desired H264 codec+configuration is not supported");case 26:r.next=32;break;case 28:if(!e.forceVP9){r.next=32;break}if(s=e.mediasoupDevice.rtpCapabilities.codecs.find((function(e){return"video/vp9"===e.mimeType.toLowerCase()})),s){r.next=32;break}throw new Error("desired VP9 codec+configuration is not supported");case 32:return e.useSimulcast&&(d=e.mediasoupDevice.rtpCapabilities.codecs.find((function(e){return"video"===e.kind})),c="video/vp9"===d.mimeType.toLowerCase()?D:R),r.next=35,e.sendTransport.produce({track:t,encodings:c,codecOptions:i,codec:s,appData:{source:"webcam",roomId:"1"}});case 35:e.webcamProducer=r.sent,e.webcamProducer.on("transportclose",(function(){e.webcamProducer=null})),e.webcamProducer.on("trackended",(function(){e.disableWebcam().catch((function(){}))})),C.debug("_setWebcamProducer() succeeded"),r.next=45;break;case 41:r.prev=41,r.t0=r["catch"](6),C.error("_setWebcamProducer() failed:%o",r.t0),t&&t.stop();case 45:case"end":return r.stop()}}),r,null,[[6,41]])})))()},disableWebcam:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(C.debug("disableWebcam()"),e.webcamProducer){r.next=3;break}return r.abrupt("return");case 3:return e.webcamProducer.close(),r.prev=4,r.next=7,e.connection.invoke("CloseProducer",e.webcamProducer.id);case 7:r.next=12;break;case 9:r.prev=9,r.t0=r["catch"](4),C.error('disableWebcam() [error:"%o"]',r.t0);case 12:e.webcamProducer=null;case 13:case"end":return r.stop()}}),r,null,[[4,9]])})))()},webcamClosed:function(){this.webcamProducer&&(this.webcamProducer.close(),this.webcamProducer=null)},_updateAudioDevices:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var t,a,n,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return C.debug("_updateAudioDevices()"),e.audioDevices={},r.prev=2,C.debug("_updateAudioDevices() | calling enumerateDevices()"),r.next=6,navigator.mediaDevices.enumerateDevices();case 6:t=r.sent,a=Object(i["a"])(t),r.prev=8,a.s();case 10:if((n=a.n()).done){r.next=17;break}if(o=n.value,"audioinput"===o.kind){r.next=14;break}return r.abrupt("continue",15);case 14:e.audioDevices[o.deviceId]=o;case 15:r.next=10;break;case 17:r.next=22;break;case 19:r.prev=19,r.t0=r["catch"](8),a.e(r.t0);case 22:return r.prev=22,a.f(),r.finish(22);case 25:r.next=30;break;case 27:r.prev=27,r.t1=r["catch"](2),C.error("_updateAudioDevices() failed: %o",r.t1);case 30:case"end":return r.stop()}}),r,null,[[2,27],[8,19,22,25]])})))()},_updateWebcams:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var t,a,n,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return C.debug("_updateWebcams()"),e.webcams=new Map,r.prev=2,C.debug("_updateWebcams() | calling enumerateDevices()"),r.next=6,navigator.mediaDevices.enumerateDevices();case 6:t=r.sent,C.debug("_updateWebcams() | %o",t),a=Object(i["a"])(t),r.prev=9,a.s();case 11:if((n=a.n()).done){r.next=19;break}if(o=n.value,"videoinput"===o.kind){r.next=15;break}return r.abrupt("continue",17);case 15:C.debug("_updateWebcams() | %o",o),e.webcams.set(o.deviceId,o);case 17:r.next=11;break;case 19:r.next=24;break;case 21:r.prev=21,r.t0=r["catch"](9),a.e(r.t0);case 24:return r.prev=24,a.f(),r.finish(24);case 27:r.next=32;break;case 29:r.prev=29,r.t1=r["catch"](2),C.error("_updateWebcams() failed: %o",r.t1);case 32:case"end":return r.stop()}}),r,null,[[2,29],[9,21,24,27]])})))()},_getAudioDeviceId:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var t;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return C.debug("_getAudioDeviceId()"),r.prev=1,C.debug("_getAudioDeviceId() | calling _updateAudioDeviceId()"),r.next=5,e._updateAudioDevices();case 5:return t=Object.values(e.audioDevices),r.abrupt("return",t[0]?t[0].deviceId:null);case 9:r.prev=9,r.t0=r["catch"](1),C.error("_getAudioDeviceId() failed: %o",r.t0);case 12:case"end":return r.stop()}}),r,null,[[1,9]])})))()},_getWebcamDeviceId:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var t;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return C.debug("_getWebcamDeviceId()"),r.prev=1,C.debug("_getWebcamDeviceId() | calling _updateWebcams()"),r.next=5,e._updateWebcams();case 5:return t=Array.from(e.webcams.values()),r.abrupt("return",t[0]?t[0].deviceId:null);case 9:r.prev=9,r.t0=r["catch"](1),C.error("_getWebcamDeviceId() failed: %o",r.t0);case 12:case"end":return r.stop()}}),r,null,[[1,9]])})))()}}},y=I,_=(t("034f"),t("2877")),j=Object(_["a"])(y,c,s,!1,null,null,null),O=j.exports;a["default"].config.productionTip=!1,a["default"].use(o.a),new a["default"]({render:function(e){return e(O)}}).$mount("#app")},"85ec":function(e,r,t){}});
//# sourceMappingURL=app.43863ce6.js.map